---
layout: post
title:  "Motoren über den Motortreiber L298 am ESP32 betreiben"
date:   2020-10-16 
tags: Motortreiber L298 ESP32
---

Um einen Motor über den Motortreiber L298 am ESP32 zu betreiben, benötigt man drei GPIO-Pins des ESP32, für ENA, IN1 und IN2. Für den Betrieb eines zweiten Motors wären dann noch drei weitere GPIO-Pins erforderlich, wir betrachten aber zunächst nur einen Motor.

Man verbindet die Pins mit den entsprechenden Eingängen des L298. Dieser wird extern mit Strom versorgt. Wir verbinden den Ground der externen Stromversorgung zudem mit Ground des ESP32.

![Fritzing L298 am ESP32](/images/fritzing_esp32_l298.png)

Wir verwenden
* Pin 4 für ENA
* Pin 2 für IN1
* Pin 15 für IN2

In MicroPython erstellen wir eine Klasse Motor, die universell genutzt werden kann:


```python
class Motor:
    def __init__(self, ena_nr, in1_nr, in2_nr):
        self.ena = machine.Pin(ena_nr, machine.Pin.OUT)
        self.in1 = machine.Pin(in1_nr, machine.Pin.OUT)
        self.in2 = machine.Pin(in2_nr, machine.Pin.OUT)
        self.pwm_ena = machine.PWM(self.ena)
        self.pwm_ena.freq(500) # 500 Hz funktioniert gut

    def set_speed(self,speed=100):
        if speed > 100:
            speed = 100
        if speed < 0:
            speed = 0
        duty = int(1023 * speed / 100)      
        self.pwm_ena.duty(duty) 

    def forward(self, speed=100):
        self.set_speed(speed)
        self.in1.value(1)
        self.in2.value(0)

    def backward(self, speed=100):
        self.set_speed(speed)
        self.in1.value(0)
        self.in2.value(1)

    def stop(self):
        self.in1.value(0)
        self.in2.value(0)

motor1 = Motor(4,15,2)
motor1.forward()
time.sleep(2)
motor1.forward(50)
time.sleep(2)
motor1.backward()
time.sleep(2)
motor1.backward(70)
time.sleep(2)
motor1.stop()
```

Dem Konstruktor `__init__` werden die GPIO-Pin-Nummern von ena, in1 und in2 übergeben. Die zugehörigen Pins werden als Ausgang konfiguriert. Auf dem ena-Pin wird PWM konfiguriert, siehe hierzu den Post über PWM.

Mit Aufruf der Methode `forward` bewegt sich der Motor durch Setzen der Werte für in1 und in2 vorwärts, beim Aufruf von `backward` bewegt er sich rückwärts. Dabei kann ein Geschwindigkeitswert zwischen 0 und 100 angegeben werden. Höhere, bzw. niedrige Werte führen zu einer Geschwindigkeit von 100 bzw. 0. 

Beim Aufruf von `stop` hält der Motor an.